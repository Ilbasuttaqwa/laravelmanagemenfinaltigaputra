{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "php artisan serve --host=0.0.0.0 --port=$PORT",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "services": {
    "mysql": {
      "image": "mysql:8.0",
      "environment": {
        "MYSQL_ROOT_PASSWORD": "railway_password_123",
        "MYSQL_DATABASE": "managemen",
        "MYSQL_USER": "railway",
        "MYSQL_PASSWORD": "railway_password_123"
      },
      "ports": ["3306:3306"],
      "volumes": ["mysql_data:/var/lib/mysql"],
      "command": [
        "mysqld",
        "--default-authentication-plugin=mysql_native_password",
        "--innodb-buffer-pool-size=128M",
        "--max-connections=100"
      ]
    }
  },
  "environments": {
    "production": {
      "variables": {
        "MYSQLHOST": "${{MySQL.MYSQLHOST}}",
        "MYSQLPORT": "${{MySQL.MYSQLPORT}}",
        "MYSQLUSER": "${{MySQL.MYSQLUSER}}",
        "MYSQLPASSWORD": "${{MySQL.MYSQLPASSWORD}}",
        "MYSQLDATABASE": "${{MySQL.MYSQLDATABASE}}",
        "MYSQL_URL": "${{MySQL.MYSQL_URL}}",
        "DB_CONNECTION": "mysql",
        "DB_HOST": "${{MySQL.MYSQLHOST}}",
        "DB_PORT": "${{MySQL.MYSQLPORT}}",
        "DB_DATABASE": "${{MySQL.MYSQLDATABASE}}",
        "DB_USERNAME": "${{MySQL.MYSQLUSER}}",
        "DB_PASSWORD": "${{MySQL.MYSQLPASSWORD}}",
        "APP_ENV": "production",
        "APP_DEBUG": "false"
      }
    }
  }
}
